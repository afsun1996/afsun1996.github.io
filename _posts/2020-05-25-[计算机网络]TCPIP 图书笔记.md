---
title: "「TCP/IP」读书笔记"
subtitle: ""
layout: post
author: "afsun"
header-style: text
tags:
  - TCP/IP
  - 读书笔记
---
# TCP/IP 读书笔记概述

## OSI参考模型和TCP/IP简化模型

![image-20200525093334349](https://tuchuansun.oss-cn-hangzhou.aliyuncs.com/image-20200525093334349.png)

OSI模型中有七层协议,分别是:

1. 应用层
2. 表示层
3. 会话层
4. 传输层
5. 网络层
6. 数据链路层
7. 物理层

### 物理层

> 最底层的负责传输数据的硬件，类似于电话线或者是无线设备。

### 数据链路层

> 相当于一个软硬件的中间层，负责提供给网络层接口去跟硬件打交道

### 网络层

>  网络层使用IP协议，提供IP协议转发数据包，用于再不同的数据链路上跳转。

![image-20200525094358082](https://tuchuansun.oss-cn-hangzhou.aliyuncs.com/image-20200525094358082.png)

#### IP协议

网络层主要就是使用的IP协议进行路由转发，可以跨越网络环境进行发送。但是不具有重发机制，属于非可靠性传输协议

#### ICMP协议

IP数据包再发送的过程中出现异常导致没有发送给目标主机，就会发送一个异常通知

#### ARP协议

在数据传输的底层，也就是链路层中并没有通过IP来直接发送到目标主机，而是将IP和网关中的信息进行比对，如果该IP地址是此网关网段中的地址则会发送一个ARP请求获取该IP地址的MAC地址，最后通过MAC地址发送给该主机信息。

### 传输层

> 传输层最主要的目的就是让应用程序之间进行通信，一个主机内部有多个进程。而传输层就是定义给消息是发送给目标主机的哪个进程的

![image-20200525095228496](https://tuchuansun.oss-cn-hangzhou.aliyuncs.com/image-20200525095228496.png)

#### TCP

> 面向有连接的传输协议，保证客户端和服务端消息都是可达的是一种可靠性传输协议。一般用在即使消息聊天等一些对消息由于可靠性要求的地方

####	 UDP

> 面向无连接的传输协议，只管发送不管是否接受到。速度快但是消息可靠性不能保证。一般用于广播或者是流媒体中

### 应用层

在TCP/IP简化版的模型中将OSI的应用层，表现层，会话层都合并成了一个应用层。OSI表现层的用处就是将传输对象的消息转换成合适的编码，会话层将管理链接的会话其实这样功能在应用层中就可以做，所以合并成了一个分层。

应用层的协议有：

+ HTTP
+ FTP
+ SSH
+ TELNET

##  数据包首部

![image-20200525150106995](https://tuchuansun.oss-cn-hangzhou.aliyuncs.com/image-20200525150106995.png)

​	在每一层都会上属于该层的首部,例如在传输层会加入传输层的首部:协议类型,端口号等信息,在网络层加入源IP地址目标IP地址等首部,在链路层则加入MAC地址等首部信息.

![image-20200525150419076](https://tuchuansun.oss-cn-hangzhou.aliyuncs.com/image-20200525150419076.png)

# 数据链路层

​	数据链路层属于软硬件结合层面,在同一链路中是通过数据链路层来发送消息的(不结果路由器的路由,只有交换机),数据链路层主要是通过主机的**MAC**地址来找到目标主机的,**MAC**地址是每个网卡在出厂时设置好的唯一地址,

## 报文结构

![image-20200525152520842](https://tuchuansun.oss-cn-hangzhou.aliyuncs.com/image-20200525152520842.png)

+ 目标MAC地址: 报文需要发送的目标端主机网卡的MAC地址
+ 源MAC地址:发送端主机网卡的MAC地址
+ 类型: 上一层协议的类型,如ARP/IP/ICMP
+ 数据: 传输的内容体
+ FCS:CRC校验计算,保证数据传输的完整性

# 网络层

IP(Internet Protocol)是网络层的核心.IP可以在不同网络环境中进行跳转通过路由器,而数据链路层只是在一个网段中对数据进行分发传递.

![image-20200525152958002](https://tuchuansun.oss-cn-hangzhou.aliyuncs.com/image-20200525152958002.png)

## 网络层和数据链路层的关系

​	类似于一个人要从北京去拉萨,他从某旅游APP上一键完成了车票购买,于是先坐火车再坐飞机最后再坐大巴车就到了目的地,这样看来,旅游APP就是路由器,具体的交通工具则是数据链路层,网络层就是下一次到站需要坐某某车,网络层连接了不同链路层之间数据的传播.

![image-20200525153421603](https://tuchuansun.oss-cn-hangzhou.aliyuncs.com/image-20200525153421603.png)

## IP如何起到作用的

​	每台主机都会有一个IP.可能是公网IP或者是局域网IP用来标识这个网段唯一的标识,主机发送数据首先会在主机中根据路由表来判断发送给哪台主机:

![image-20200525155308092](https://tuchuansun.oss-cn-hangzhou.aliyuncs.com/image-20200525155308092.png)

如图所示,每台主机都会维护一个路由表:

如请求地址为 10.85.11.22 会自动走192.168.1.1这个路由器

如果请求地址为为 202.11.3.11 则会走向默认的路由表 192.168.101.1

同样设备越来越多的情况下路由表会越来越大,这个时候路由表也会自动合并优化成小表.

当主机根据路由表发送到网关后(**路由器**),网关再次根据自身的路由表再转发到一个个网段,下个网段的网关判断目标IP是否为此网段的地址,如果是则根据ARP协议找到该IP的MAC地址,将请求发送给这个MAC地址.如果不是此网段的则继续之前的操作.

## IP的基础知识

### 非传输线协议

​	IP协议是面向无连接的,没有重发机制.属于非可靠性传输协议.为什么IP要做成非可靠性的协议呢?

这是因为上层还有传输层的协议,网络层的IP只需要将自身的传输做好就可以了,这也符合设计模式中的责任单一制,后续的可靠性扩展可以交给更上层的协议完成.

### IP地址组成

​	IP地址由【网络地址】+【主机标识】组成的，网络标识是可以重复，用来判断多个主机是否是同一网段的，而主机标识在同一网段中必须是唯一的，IP转发到某个路由器正是由网络标识判断该IP的目的主机是否在此网段中。

通过两个方式判断网络标识：1 是由子网掩码的方式 （**MAIN**）2 通过网络分类的方式(基本废弃了)

> IP地址在一开始分成了ABCDE，五种类型。目前已经不采用这样的ABCD分级IP制了（以为已经由子网掩码来判断网络标识位）

### 单播广播和多播

​	单播就是典型的1对1通信，客户端对服务端。

​	广播分为本地广播和直接广播，本地广播就是在本网段中进行广播如：网段192.168.2.0/24 网段内进行广播192.168.2.255。直接国博就是在不同网段内进行广播。广播在IP中的体现就是将主机标识位全部置1

​	多播是用来满足一对多，多对多的通信.其实也可以用单播的方式来实现多播的功能，但是需要大量的发送请求完成。广播的方式则会给那些毫无关系的网络带来影响且广播无法通过路由器来分发。通过加入D类的IP组来实现

![image-20200525170503638](https://tuchuansun.oss-cn-hangzhou.aliyuncs.com/image-20200525170503638.png)

### IPV4的首部

![image-20200525171145539](https://tuchuansun.oss-cn-hangzhou.aliyuncs.com/image-20200525171145539.png)

版本：IP协议的版本好，例如IPv4的版本就是4

首部长度：表面IP首部的大小

区分服务：表面服务质量，目前已经被划分为**DSCP**和**ECN**

![image-20200525171846091](C:\Users\afsun\AppData\Roaming\Typora\typora-user-images\image-20200525171846091.png)![image-20200525171853371](C:\Users\afsun\AppData\Roaming\Typora\typora-user-images\image-20200525171853371.png)

+ DSCP（Differential Services Codepoint）是用以实现TOS的部分，提供了8种类型的质量级别
+ ECN （Explict Congestion Notification）用来报告网络阻塞的情况由两个byte组成

总长度：首部+数据的总长度

标识： 用于MTU切分分组后的重组，每个分片的标识应该相同

标志：![image-20200525172248021](C:\Users\afsun\AppData\Roaming\Typora\typora-user-images\image-20200525172248021.png)

片偏移：标识被分片的每一个分段相对于原始数据的位置，用来标识组装数据的顺序

生存时间（TTL）：每次被路由转发都会被减1，当变成0的时候就表示丢弃该数据包，该特性后面可以用来做**路由追踪**