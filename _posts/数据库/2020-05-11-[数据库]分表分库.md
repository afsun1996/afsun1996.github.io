---
title: "「数据库」分表分库"
subtitle: ""
layout: post
author: "afsun"
categories:
  - 数据库
header-style: text
tags:
  - 数据库
---
# 分表分库

- 分为水平切分和垂直切分,水平切分就是将表结构复制一样的,然后按照一定的规则将原表中的数据抽出一部分放入另一个表,一般用来解决,单表数据量过大,优化查询和插入的速度,提高数据库的吞吐量.垂直切分是将表中的某些字段抽出,独立成另一张表侧重于业务的切分.

## 垂直切分

将一个完整的表单由业务组成来切分,再根据一定的key来关联,这就是垂直切分

优点: 业务细化,切分后可以将表放入不同的数据库减轻数据库访问的压力,冷热数据分离

缺点: 如果抽离的表放入了其他数据库中,会存在跨库的问题 关联数据比较麻烦

### 冷热分离:

- 冷数据指的是 查询多于修改,热数据指的是修改大于查询

微博中文章的标题,作者就是冷数据,而点赞,浏览次数属于热数据.将冷热数据抽离然后放在不同的数据库中,列入热数据放入innodb引擎的数据库,冷数据放入myisam引擎的数据库.且对于冷数据还可以配置主从复制模式,配置多个从库减少查询的压力.

## 水平切分

将表的结构复制一份到另一个数据库上,再从原表中按照一定的规则抽取数据到其他表中,在插入和查询时可以按照一定的规则到不同的数据库中查询.

优点: 提高数据库的吞吐量,减轻单个数据库的负载

缺点: 查询范围数据的时候需要聚合,实现事务复杂

### 哈希切片

 将目标的ID通过hash算法后取模运算出该数据对应的数据库的序号.

优点: 数据落地比较均匀,分散性较好

缺点: 数据分散后对于查询操作需要做聚合

### 时间切片

  按照时间的范围分布到不同的片上,用于拥有较强的时效性的数据上

### 区间范围切片

一般在有严格的自增id需求上，如按照user_id水平分表：

table_1 user_id从1~100w

table_2 user_id从101~200w

table_3 user_id从201~300w

## 分片方案

### 应用层实现

由应用层来根据分片规则,判断每次需要执行的数据库操作是对应哪个数据库片.实现较简单

### ORM层实现

在orm框架侧面来实现分片的逻辑

Mybatis

![Untitled%202ce0c04238c54004b1f4c0ace1139ded/Untitled.png](http://tuchuansun.oss-cn-hangzhou.aliyuncs.com/typora/202005/11/085609-335107.png)

### JDBC层实现

在jdbc的底层来实现分片逻辑和分发,让业务开发人员无需考虑数据库的问题,简化开发.ShardingJDBC.