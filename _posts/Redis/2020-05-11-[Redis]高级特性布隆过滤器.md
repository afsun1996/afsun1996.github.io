---
title: "「Redis」Redis高级特性布隆过滤器"
subtitle: ""
layout: post
author: "afsun"
header-style: text
hidden: true
tags:
  - Redis
---
# 布隆过滤器

- redis4.0的新功能，适用于对于过滤准确性要求不高的场景

使用场景：

   在新闻推送的时候，一般的app会将已经看过的新闻自动过滤掉，不用再刷新显示了。而从偏大的新闻数据里面拿到已经被用户阅读过的数据，如果用数据库来实现那么偏大的查询和数据量会吃不消，如果放在缓存的SET中那么巨大数据量也会让内存吃不消，可以使用布隆过滤器将个人信息作为key 阅读过的信息作为value插入到布隆过滤器中，每次获取新闻列表的时候都去布隆过滤去筛选一遍没有看过的。

特点： 不是百分百准确，如果布隆过滤器得出结论不存在那么一定不存在，如果得出存在则不一定真正存在

## 原理

![Untitled%206d90cdad94f441f3ad104eb92222b1f2/Untitled.png](http://tuchuansun.oss-cn-hangzhou.aliyuncs.com/typora/202005/11/091635-361709.png)

将一对KEY-VALUE插入到布隆过滤器中：

1. 由多种HASH算法将KEY计算为一个整数的索引
2. 将索引跟布隆中的容量数组取模，得到该key落在数组的位置
3. 多个HASH算法算出多个位置，将数组这些位置都标为1

使用exists时的过程：

1. 用多种hash算法将此key的所有可能落点都计算出来
2. 判断是否所有落点都为1，如果是则**存在** 如果不全是1则为**不存在**

## 参数设置

F 为错误率   L为数组长度（bit位）N为预计的元素数量 K为hash函数的数量

K = 0.7 * (L/N)

F = 0.6187^(L/N)

由此可见 错误率和容量成反比关系，容量设置的越大则错误率越低需要的hash函数数目越少

如果设置的过大则会浪费内存空间，如果设置的容量越小则错误率越大，而且需要hash函数的过程变多，使得计算效率下降

大致的看

1. 错误率为10% 时，一个元素需要4.79个bit  近似看成5比特
2. 错误率为1%时，一个元素需要9.58个bit      近似看成10比特
3. 错误率为0.1%时，一个元素需要14.38个bit  近似看成15比特

相当于SET来说，布隆只存储key的“指纹信息”，而SET会将字符串或者对象序列化存储进redis，元素的内容通常几十到上百个字节，而布隆只有15位左右也就是2个字节，优势相当大

## 用途

- 爬虫URL去重
- 检查垃圾邮件
- 解决缓存穿透 →高性能解决方案
- 过滤一些大数据下对准确性要求不高的数据

## 实战